name: Criar Test Data

on:
  workflow_dispatch: # dispara manualmente

jobs:
  create-test-data:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Instalar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Instalar dependÃªncias
        run: npm install
        working-directory: fontes/backend

      - name: Instalar ts-node global
        run: npm install -g ts-node typescript

      # ğŸ”¹ Primeiro gera/atualiza o test-data
      - name: Atualizar test-data
        run: npm run update-test-data
        working-directory: fontes/backend

      # ğŸ”¹ Depois roda os testes dinÃ¢micos
      - name: Rodar testes dinÃ¢micos
        run: npm run dynamic-tests
        working-directory: fontes/backend

      # ğŸ”¹ Apenas salva a pasta test-data
      - name: Upload do test-data
        uses: actions/upload-artifact@v4
        with:
          name: test-data
          path: fontes/backend/test-data
