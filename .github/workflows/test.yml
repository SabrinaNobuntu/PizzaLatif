name: Gerar Test Data

on:
  workflow_dispatch: # Executado manualmente

jobs:
  generate-test-data:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Instalar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Instalar dependÃªncias backend
        run: npm install
        working-directory: fontes/backend

      - name: Instalar ts-node global
        run: npm install -g ts-node typescript

      # ğŸ”¹ update-test-data vem primeiro
      - name: Atualizar test-data
        run: npm run update-test-data
        working-directory: fontes/backend

      # ğŸ”¹ depois roda os dynamic-tests
      - name: Rodar testes dinÃ¢micos
        run: npm run dynamic-tests
        working-directory: fontes/backend

      # ğŸ”¹ upload apenas da pasta test-data (sem relatÃ³rios!)
      - name: Upload do test-data
        uses: actions/upload-artifact@v4
        with:
          name: test-data
          path: fontes/backend/test-data
